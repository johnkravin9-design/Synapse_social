{% extends "base.html" %}

{% block title %}Feed - Synapse{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-6">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Left Sidebar -->
        <div class="lg:col-span-3 space-y-4">
            <!-- Live Activity -->
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-purple-500">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <i class="fas fa-bolt text-yellow-400 mr-2"></i>
                    Live Activity
                </h3>
                <div id="live-activity" class="space-y-3">
                    <div class="text-sm bg-white/5 p-2 rounded animate-pulse">ğŸ‘¤ Loading activity...</div>
                </div>
            </div>
            
            <!-- Invite System -->
            <div class="bg-gradient-to-br from-yellow-600 to-orange-600 rounded-xl p-4 border border-yellow-400">
                <h3 class="font-bold text-lg mb-2 flex items-center">
                    <i class="fas fa-gift mr-2"></i>
                    Invite & Earn
                </h3>
                <p class="text-sm mb-3">Get 100 points per friend!</p>
                <div class="bg-black/30 rounded p-2 mb-3 text-center font-mono text-sm" id="invite-code">
                    SYNAPSE-XXXX
                </div>
                <button onclick="copyInvite()" class="w-full bg-white text-orange-600 font-bold py-2 rounded-lg hover:bg-opacity-90 transition">
                    Copy Invite Link
                </button>
            </div>
        </div>
        
        <!-- Main Feed -->
        <div class="lg:col-span-6 space-y-4">
            <!-- Stories -->
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-purple-500">
                <div class="flex items-center space-x-4 overflow-x-auto pb-2" id="stories-container">
                    <!-- Create Story -->
                    <div class="flex-shrink-0 text-center">
                        <a href="/create" class="story-circle border-4 border-dashed border-gray-500">
                            <div class="w-16 h-16 rounded-full flex items-center justify-center">
                                <i class="fas fa-plus text-2xl"></i>
                            </div>
                        </a>
                        <p class="text-xs mt-1">Create</p>
                    </div>
                    <!-- Stories will load here -->
                </div>
            </div>
            
            <!-- Create Post -->
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-purple-500">
                <div class="flex space-x-3">
                    <span id="user-avatar-post" class="text-3xl">ğŸš€</span>
                    <div class="flex-1">
                        <textarea 
                            id="post-content"
                            placeholder="What's on your mind?"
                            class="w-full bg-white/10 rounded-lg p-3 border border-purple-400 focus:border-pink-400 outline-none resize-none"
                            rows="3"
                        ></textarea>
                        
                        <div class="flex items-center justify-between mt-3">
                            <div class="flex space-x-2">
                                <button onclick="window.location.href='/create'" class="p-2 bg-blue-600 rounded-lg hover:bg-blue-700 transition">
                                    <i class="fas fa-image"></i>
                                </button>
                                <button class="p-2 bg-purple-600 rounded-lg hover:bg-purple-700 transition">
                                    <i class="fas fa-users"></i>
                                </button>
                            </div>
                            <button onclick="quickPost()" class="bg-gradient-to-r from-pink-500 to-purple-500 px-6 py-2 rounded-lg font-bold hover:from-pink-600 hover:to-purple-600 transition">
                                Post
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Posts Feed -->
            <div id="posts-container" class="space-y-4">
                <div class="text-center py-8">
                    <i class="fas fa-spinner fa-spin text-4xl text-pink-500"></i>
                    <p class="mt-2 text-gray-400">Loading posts...</p>
                </div>
            </div>
        </div>
        
        <!-- Right Sidebar -->
        <div class="lg:col-span-3 space-y-4">
            <!-- Trending -->
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-purple-500">
                <h3 class="font-bold text-lg mb-4">ğŸ”¥ Trending</h3>
                <div class="space-y-3">
                    <div class="flex justify-between text-sm hover:bg-white/5 p-2 rounded cursor-pointer">
                        <span>#Innovation</span>
                        <span class="text-gray-400">234K</span>
                    </div>
                    <div class="flex justify-between text-sm hover:bg-white/5 p-2 rounded cursor-pointer">
                        <span>#Startup</span>
                        <span class="text-gray-400">189K</span>
                    </div>
                    <div class="flex justify-between text-sm hover:bg-white/5 p-2 rounded cursor-pointer">
                        <span>#AI</span>
                        <span class="text-gray-400">567K</span>
                    </div>
                </div>
            </div>
            
            <!-- Suggested Friends -->
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-purple-500">
                <h3 class="font-bold text-lg mb-4">Suggested</h3>
                <div id="suggestions" class="space-y-3">
                    <p class="text-sm text-gray-400">Loading suggestions...</p>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    const API_URL = 'http://localhost:5000';
    let currentUser = JSON.parse(localStorage.getItem('synapse_user') || '{}');
    
    function getToken() {
        return localStorage.getItem('synapse_token');
    }

    // Check if logged in
    if (!getToken()) {
        window.location.href = '/login';
    }

    // Update user avatar
    if (currentUser.avatar) {
        document.getElementById('user-avatar-post').textContent = currentUser.avatar;
    }

    // Load feed on page load
    window.addEventListener('load', async () => {
        await loadStories();
        await loadPosts();
        startLiveActivity();
        generateInviteCode();
    });

async function loadStories() {
â€    try {
â€        const response = await fetch(API_URL + '/api/stories', {
â€            headers: { 'Authorization': `Bearer ${getToken()}` }
â€        });
â€        const result = await response.json();
â€        
â€        if (result.stories && result.stories.length > 0) {
â€            renderStories(result.stories);
â€        }
â€    } catch (error) {
â€        console.error('Error loading stories:', error);
â€    }
â€}
â€
â€function renderStories(stories) {
â€    const container = document.getElementById('stories-container');
â€    const existingCreate = container.querySelector('.flex-shrink-0');
â€    
â€    const storiesHTML = stories.map(story => `
â€        <div class="flex-shrink-0 text-center cursor-pointer" onclick="viewStory(${story.id})">
â€            <div class="w-16 h-16 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 p-1">
â€                <div class="w-full h-full rounded-full bg-gray-900 flex items-center justify-center text-3xl">
â€                    ${story.user.avatar}
â€                </div>
â€            </div>
â€            <p class="text-xs mt-1 truncate w-16">${story.user.username}</p>
â€        </div>
â€    `).join('');
â€    
â€    container.innerHTML = existingCreate.outerHTML + storiesHTML;
â€}
â€
â€// Call loadStories in window.onload
â€window.addEventListener('load', async () => {
â€    await loadStories();  // ADD THIS LINE
â€    await loadPosts();
â€});
â€

    async function loadPosts() {
        try {
            const token = getToken();
            const endpoint = token ? '/api/posts' : '/api/public/posts';
            const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
            
            const response = await fetch(API_URL + endpoint, { headers });
            const result = await response.json();
            
            renderPosts(result.posts);
        } catch (error) {
            console.error('Error loading posts:', error);
            document.getElementById('posts-container').innerHTML = `
                <div class="text-center py-8">
                    <i class="fas fa-exclamation-circle text-4xl text-red-500"></i>
                    <p class="mt-2 text-red-400">Error loading posts</p>
                </div>
            `;
        }
    }

    function renderPosts(posts) {
        const container = document.getElementById('posts-container');
        
        if (posts.length === 0) {
            container.innerHTML = `
                <div class="text-center py-8">
                    <i class="fas fa-images text-6xl text-gray-600"></i>
                    <p class="mt-4 text-xl">No posts yet</p>
                    <a href="/create" class="mt-4 inline-block bg-pink-500 px-6 py-3 rounded-full font-bold">Create First Post</a>
                </div>
            `;
            return;
        }

        container.innerHTML = posts.map(post => `
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-purple-500">
                <!-- Post Header -->
                <div class="flex items-start gap-3 mb-3">
                    <span class="text-3xl">${post.user.avatar}</span>
                    <div class="flex-1">
                        <h4 class="font-bold flex items-center">
                            ${post.user.username}
                            ${post.user.is_verified ? '<i class="fas fa-check-circle text-blue-500 text-sm ml-1"></i>' : ''}
                        </h4>
                        <p class="text-xs text-gray-400">${post.timestamp}</p>
                    </div>
                </div>
                
                <!-- Post Content -->
                ${post.content ? `<p class="mb-3">${post.content}</p>` : ''}
                
                <!-- Post Image -->
                ${post.image ? `
                    <div class="bg-black/40 rounded-lg p-8 text-center text-8xl mb-3">
                        ${post.image.startsWith('data:') ? 
                            `<img src="${post.image}" class="max-w-full max-h-96 mx-auto rounded-lg" />` :
                            post.image
                        }
                    </div>
                ` : ''}
                
                <!-- Post Stats -->
                <div class="flex items-center justify-between text-sm text-gray-400 mb-3 pb-3 border-b border-gray-700">
                    <span>${post.likes} likes</span>
                    <div class="flex gap-4">
                        <span>${post.comments} comments</span>
                        <span>${post.shares} shares</span>
                    </div>
                </div>
                
                <!-- Post Actions -->
                <div class="flex items-center gap-2">
                    <button onclick="likePost(${post.id})" class="flex-1 flex items-center justify-center gap-2 py-2 bg-white/10 rounded-lg hover:bg-pink-500 transition">
                        <i class="far fa-heart text-xl"></i>
                        Like
                    </button>
                    <button class="flex-1 flex items-center justify-center gap-2 py-2 bg-white/10 rounded-lg hover:bg-blue-500 transition">
                        <i class="far fa-comment text-xl"></i>
                        Comment
                    </button>
                    <button onclick="sharePost(${post.id})" class="flex-1 flex items-center justify-center gap-2 py-2 bg-white/10 rounded-lg hover:bg-green-500 transition">
                        <i class="far fa-paper-plane text-xl"></i>
                        Share
                    </button>
                </div>
            </div>
        `).join('');
    }

async function createReel() {
    const fileInput = document.getElementById('reel-file');
    const caption = document.getElementById('reel-caption').value;
    
    if (!fileInput.files[0]) {
        alert('Please select a file');
        return;
    }

    try {
        // 1. First upload the file
        const formData = new FormData();
        formData.append('file', fileInput.files[0]);
        
        const uploadResponse = await fetch('/api/upload', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: formData
        });
        
        const uploadResult = await uploadResponse.json();
        
        if (!uploadResult.success) {
            throw new Error('Upload failed');
        }

        // 2. Then create the reel with the data_url
        const reelData = {
            media_url: uploadResult.data_url,  // Use the returned data_url
            caption: caption,
            media_type: uploadResult.file_type  // 'image' or 'video'
        };

        const reelResponse = await fetch('/api/reels', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(reelData)
        });

        const result = await reelResponse.json();
        
        if (reelResponse.ok) {
            alert('Reel created successfully!');
            // Clear form
            fileInput.value = '';
            document.getElementById('reel-caption').value = '';
        } else {
            alert('Error: ' + result.error);
        }
    } catch (error) {
        console.error('Error creating reel:', error);
        alert('Failed to create reel');
    }
}

   â€async function quickPost() {
â€Â Â Â  const content = document.getElementById('post-content').value.trim();
â€Â Â Â  
â€Â Â Â  if (!content) {
â€Â Â Â Â Â Â Â  showToast('âŒ Please write something!', 'error');
â€Â Â Â Â Â Â Â  return;
â€Â Â Â  }
â€
â€Â Â Â  try {
â€Â Â Â Â Â Â Â  const response = await fetch(API_URL + '/api/posts', {
â€Â Â Â Â Â Â Â Â Â Â Â  method: 'POST',
â€Â Â Â Â Â Â Â Â Â Â Â  headers: {
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  'Content-Type': 'application/json',
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  'Authorization': `Bearer ${getToken()}`
â€Â Â Â Â Â Â Â Â Â Â Â  },
â€Â Â Â Â Â Â Â Â Â Â Â  body: JSON.stringify({
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  content: content,
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  image: null,
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  location: '',
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  taggedUsers: []
â€Â Â Â Â Â Â Â Â Â Â Â  })
â€Â Â Â Â Â Â Â  });
â€
â€Â Â Â Â Â Â Â  const result = await response.json();
â€
â€Â Â Â Â Â Â Â  if (response.ok) {
â€Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('post-content').value = '';
â€Â Â Â Â Â Â Â Â Â Â Â  showToast('âœ… Post created!', 'success');
â€Â Â Â Â Â Â Â Â Â Â Â  await loadPosts();
â€Â Â Â Â Â Â Â  } else {
â€Â Â Â Â Â Â Â Â Â Â Â  showToast('âŒ ' + (result.error || 'Failed to create post'), 'error');
â€Â Â Â Â Â Â Â  }
â€Â Â Â  } catch (error) {
â€Â Â Â Â Â Â Â  console.error('Error creating post:', error);
â€Â Â Â Â Â Â Â  showToast('âŒ Error: ' + error.message, 'error');
â€Â Â Â  }
â€}

   async function likePost(postId) {
â€Â Â Â  try {
â€Â Â Â Â Â Â Â  const response = await fetch(`${API_URL}/api/posts/${postId}/like`, {
â€Â Â Â Â Â Â Â Â Â Â Â  method: 'POST',
â€Â Â Â Â Â Â Â Â Â Â Â  headers: {
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  'Content-Type': 'application/json',
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  'Authorization': `Bearer ${getToken()}`
â€Â Â Â Â Â Â Â Â Â Â Â  }
â€Â Â Â Â Â Â Â  });
â€
â€Â Â Â Â Â Â Â  if (response.ok) {
â€Â Â Â Â Â Â Â Â Â Â Â  const result = await response.json();
â€Â Â Â Â Â Â Â Â Â Â Â  showToast('â¤ï¸ ' + result.message);
â€Â Â Â Â Â Â Â Â Â Â Â  await loadPosts(); // Reload to show updated likes
â€Â Â Â Â Â Â Â  } else {
â€Â Â Â Â Â Â Â Â Â Â Â  const error = await response.json();
â€Â Â Â Â Â Â Â Â Â Â Â  showToast('âŒ ' + error.error, 'error');
â€Â Â Â Â Â Â Â  }
â€Â Â Â  } catch (error) {
â€Â Â Â Â Â Â Â  console.error('Error liking post:', error);
â€Â Â Â Â Â Â Â  showToast('âŒ Error liking post', 'error');
â€Â Â Â  }
â€}

    async function sharePost(postId) {
        try {
            await fetch(`${API_URL}/api/posts/${postId}/share`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${getToken()}`
                }
            });

            const link = `${window.location.origin}/p/${postId}`;
            navigator.clipboard.writeText(link);
            showToast('ğŸ“¤ Link copied to clipboard!');
        } catch (error) {
            showToast('âŒ Error sharing post', 'error');
        }
    }

    function openCommentModal(postId) {
â€Â Â Â  // Create modal dynamically
â€Â Â Â  const modal = document.createElement('div');
â€Â Â Â  modal.id = 'comment-modal';
â€Â Â Â  modal.className = 'fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4';
â€Â Â Â  modal.innerHTML = `
â€Â Â Â Â Â Â Â  <div class="bg-gray-900 rounded-2xl w-full max-w-md">
â€Â Â Â Â Â Â Â Â Â Â Â  <div class="p-4 border-b border-gray-800 flex justify-between items-center">
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <h3 class="text-xl font-bold">Comments</h3>
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <button onclick="closeCommentModal()" class="text-gray-400 hover:text-white">
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <i class="fas fa-times"></i>
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </button>
â€Â Â Â Â Â Â Â Â Â Â Â  </div>
â€Â Â Â Â Â Â Â Â Â Â Â  <div id="comments-list" class="p-4 max-h-96 overflow-y-auto">
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <p class="text-gray-400 text-center">Loading comments...</p>
â€Â Â Â Â Â Â Â Â Â Â Â  </div>
â€Â Â Â Â Â Â Â Â Â Â Â  <div class="p-4 border-t border-gray-800">
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="flex space-x-2">
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <input 
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  type="text" 
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  id="comment-input-${postId}"
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  placeholder="Add a comment..."
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  class="flex-1 bg-gray-800 rounded-full px-4 py-2 focus:outline-none"
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  >
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <button onclick="postComment(${postId})" class="bg-pink-500 hover:bg-pink-600 px-4 py-2 rounded-full">
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Post
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </button>
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>
â€Â Â Â Â Â Â Â Â Â Â Â  </div>
â€Â Â Â Â Â Â Â  </div>
â€Â Â Â  `;
â€Â Â Â  document.body.appendChild(modal);
â€Â Â Â  loadComments(postId);
â€}
â€
â€function closeCommentModal() {
â€Â Â Â  const modal = document.getElementById('comment-modal');
â€Â Â Â  if (modal) modal.remove();
â€}
â€
â€async function loadComments(postId) {
â€Â Â Â  try {
â€Â Â Â Â Â Â Â  const response = await fetch(`${API_URL}/api/posts/${postId}/comments`, {
â€Â Â Â Â Â Â Â Â Â Â Â  headers: { 'Authorization': `Bearer ${getToken()}` }
â€Â Â Â Â Â Â Â  });
â€Â Â Â Â Â Â Â  const result = await response.json();
â€Â Â Â Â Â Â Â  
â€Â Â Â Â Â Â Â  const list = document.getElementById('comments-list');
â€Â Â Â Â Â Â Â  if (result.comments.length === 0) {
â€Â Â Â Â Â Â Â Â Â Â Â  list.innerHTML = '<p class="text-gray-400 text-center">No comments yet</p>';
â€Â Â Â Â Â Â Â Â Â Â Â  return;
â€Â Â Â Â Â Â Â  }
â€Â Â Â Â Â Â Â  
â€Â Â Â Â Â Â Â  list.innerHTML = result.comments.map(comment => `
â€Â Â Â Â Â Â Â Â Â Â Â  <div class="mb-4">
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="flex items-start space-x-2">
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class="text-2xl">${comment.user.avatar}</span>
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div>
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <p class="font-bold text-sm">${comment.user.username}</p>
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <p class="text-sm">${comment.content}</p>
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>
â€Â Â Â Â Â Â Â Â Â Â Â  </div>
â€Â Â Â Â Â Â Â  `).join('');
â€Â Â Â  } catch (error) {
â€Â Â Â Â Â Â Â  console.error('Error loading comments:', error);
â€Â Â Â  }
â€}
â€
â€async function postComment(postId) {
â€Â Â Â  const input = document.getElementById(`comment-input-${postId}`);
â€Â Â Â  const content = input.value.trim();
â€Â Â Â  
â€Â Â Â  if (!content) return;
â€Â Â Â  
â€Â Â Â  try {
â€Â Â Â Â Â Â Â  const response = await fetch(`${API_URL}/api/posts/${postId}/comment`, {
â€Â Â Â Â Â Â Â Â Â Â Â  method: 'POST',
â€Â Â Â Â Â Â Â Â Â Â Â  headers: {
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  'Content-Type': 'application/json',
â€Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  'Authorization': `Bearer ${getToken()}`
â€Â Â Â Â Â Â Â Â Â Â Â  },
â€Â Â Â Â Â Â Â Â Â Â Â  body: JSON.stringify({ content })
â€Â Â Â Â Â Â Â  });
â€Â Â Â Â Â Â Â  
â€Â Â Â Â Â Â Â  if (response.ok) {
â€Â Â Â Â Â Â Â Â Â Â Â  input.value = '';
â€Â Â Â Â Â Â Â Â Â Â Â  await loadComments(postId);
â€Â Â Â Â Â Â Â Â Â Â Â  showToast('ğŸ’¬ Comment added!');
â€Â Â Â Â Â Â Â  }
â€Â Â Â  } catch (error) {
â€Â Â Â Â Â Â Â  console.error('Error posting comment:', error);
â€Â Â Â  }
â€}
â€
â€// Update the Comment button in renderPosts:
â€// Change this:
â€// <button class="...">Comment</button>
â€// To this:
â€// <button onclick="openCommentModal(${post.id})" class="...">Comment</button>

    function startLiveActivity() {
        const activities = [
            'ğŸ‘¤ New user joined Synapse',
            'â¤ï¸ Someone liked your post',
            'ğŸ’¬ New comment on your post',
            'ğŸ”¥ Trending: #Innovation',
            'âš¡ 50 users online now',
            'ğŸ¯ Someone shared your post'
        ];
        
        setInterval(() => {
            const activity = activities[Math.floor(Math.random() * activities.length)];
            const container = document.getElementById('live-activity');
            container.innerHTML = `<div class="text-sm bg-white/5 p-2 rounded animate-pulse">${activity}</div>` + container.innerHTML.split('</div>')[0] + '</div>';
        }, 5000);
    }

    function generateInviteCode() {
        const code = 'SYNAPSE-' + Math.random().toString(36).substr(2, 6).toUpperCase();
        document.getElementById('invite-code').textContent = code;
    }

    function copyInvite() {
        const code = document.getElementById('invite-code').textContent;
        navigator.clipboard.writeText(`Join Synapse with my invite code: ${code}\n${window.location.origin}/register`);
        showToast('ğŸ‰ Invite link copied! Share it to earn 100 points!');
    }

    function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `fixed top-4 right-4 px-6 py-4 rounded-lg shadow-lg z-50 ${
            type === 'success' ? 'bg-green-500' : 'bg-red-500'
        }`;
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }
</script>
{% endblock %}
